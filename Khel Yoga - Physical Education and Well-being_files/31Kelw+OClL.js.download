'use strict';mix_d("MonarchShoppingCXFeedbackWidgetCards__shopping-cx-feedback-widget:shopping-cx-feedback-widget__oyIdiZSG","exports tslib @c/logger @c/metrics @c/pagemarker @c/scoped-dom @c/dom @c/remote-operations".split(" "),function(I,F,P,q,Q,R,S,T){function x(a){return a&&"object"===typeof a&&"default"in a?a:{"default":a}}var r=x(P),U=x(Q),e=x(R),G=x(S),V=x(T),z=function(){return V["default"].setup()},W={CREDIT_CARD_NUMBER:[/\b\d{15,16}\b/i,/\b\d{4}([\- ])\d{4}\1\d{4}\1\d{4}\b/i],PASSPORT:[/\b[Cc\d]\d{8}\b/i],
ADDRESS:[/\d{1,5}\s([\w\.\-]+\s){1,3}(st|ln|rd|ave|dr|pl|pkwy|blvd|street|lane|road|avenue|drive|parkway|boulevard)\b/i],PHONE_NUMBER:[/\b(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?\b/g],EMAIL:[/[a-z0-9!#$%&'*+\/=?\^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?\^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/i]},
X={NA:{CREDIT_CARD_NUMBER:[/\b\d{4}([\- ])\d{6}\1\d{5}\b/i],NATIONAL_IDENTIFIER:[/\b(?!000)\d{3}[\- ](?!00)\d{2}[\- ](?!0000)\d{4}\b/i,/\b\d{2}[\- ]\d{7}\b/i],PASSPORT:[/\b[A-z]{2}[0-9]{7}\b/i],ADDRESS:[/\b\d{5}[ \-]\d{4}\b/,/\b(?:[ABCEGHJ-NPRSTVXY]\d[A-Z][ -]?\d[A-Z]\d)\b/i],PHONE_NUMBER:[/\b(?:\+\d{1,3}[\( \-\/\-])?(?:\d{3}|\(\d{3}\))([ -\/\.])\d{3}([\-\/\.])\d{4}\s*((x|ex\w*|#)\s*\d+)?\b/g]},EU:{CREDIT_CARD_NUMBER:[],NATIONAL_IDENTIFIER:[],PASSPORT:[/\b[A-z][0-9]{6}\b/i,/\b[A-z]{2}[0-9]{7}\b/i,
/\b[A-z0-9][0-9]{7}\b/i,/\b[CFGHJK0-9][0-9]{3}[CHJKLMNPRTVWXYZ0-9]{5}[0-9]\b/i,/\b[A-z][0-9]{6,7}\b/i,/\b[0-9]{12}\b/i,/\b[0-9]{2}[A-z]{2}[0-9]{5}\b/i,/\b[A-z] ?[0-9]{7}\b/i],ADDRESS:[/\b(?:[0-8]\d|9[0-8])\d{3}\b/i,/\b\d{5}\b/i,/\b(?:NL-)?(?:[1-9]\d{3} ?(?:[A-EGHJ-NPRTVWXZ][A-EGHJ-NPRSTVWXZ]|S[BCEGHJ-NPRTVWXZ]))\b/i,/\b(?:0[1-9]|[1-4]\d|5[0-2])\d{3}\b/,/\b[1-9]\d{3}\b/,/\b(?:GIR 0AA|(?:(?:(?:A[BL]|B[ABDHLNRSTX]?|C[ABFHMORTVW]|D[ADEGHLNTY]|E[HNX]?|F[KY]|G[LUY]?|H[ADGPRSUX]|I[GMPV]|JE|K[ATWY]|L[ADELNSU]?|M[EKL]?|N[EGNPRW]?|O[LX]|P[AEHLOR]|R[GHM]|S[AEGK-PRSTY]?|T[ADFNQRSW]|UB|W[ADFNRSV]|YO|ZE)[1-9]?\d|(?:(?:E|N|NW|SE|SW|W)1|EC[1-4]|WC[12])[A-HJKMNPR-Y]|(?:SW|W)(?:[2-9]|[1-9]\d)|EC[1-9]\d)\d[ABD-HJLNP-UW-Z]{2}))\b/i],
PHONE_NUMBER:[/(\+|\b011\W*)(9[976]\d|8[987530]\d|6[987]\d|5[90]\d|42\d|3[875]\d|2[98654321]\d|9[8543210]|8[6421]|6[6543210]|5[87654321]|4[987654310]|3[9643210]|2[70]|7)(\W*\d){1,14}\b/i]},FE:{CREDIT_CARD_NUMBER:[],NATIONAL_IDENTIFIER:[],PASSPORT:[/\b[Cc\d]\d{8}\b/i],ADDRESS:[/\b(?:(?:[2-8]\d|9[0-7]|0?[28]|0?9(?=09))(?:\d{2}))\b/i,/\b\d{3}-\d{4}\b/],PHONE_NUMBER:[/(\+|\b011\W*)(9[976]\d|8[987530]\d|6[987]\d|5[90]\d|42\d|3[875]\d|2[98654321]\d|9[8543210]|8[6421]|6[6543210]|5[87654321]|4[987654310]|3[9643210]|2[70]|7)(\W*\d){1,14}\b/i]}},
Y={ABUSE_WORD:[/\bsh[i|*|1]t\b|\bf[u|*][c|*]k\b|\bb[i|*]tch\b|\bcrap\b|\bsucks\b|\bdamn\b|\bwhore\b|\bass\b|\\s/ig]},c;(function(a){a.NA="NA";a.FE="FE";a.EU="EU"})(c||(c={}));var J;(J||(J={})).PNG="png";var Z=/[0-9]{9}[0-9X]|[A-Z][A-Z0-9]{9}/,H=function(a,b,f){var d,h,n=b.violationMap;b=b.textAfterValidation;for(var g in a){var A=a[g];try{for(var t=(d=void 0,F.__values(A)),k=t.next();!k.done;k=t.next()){var m=b.match(k.value);m&&(m="CREDIT_CARD_NUMBER"===g?m.filter(Boolean).filter(aa):m.filter(Boolean),
0<m.length&&(f?b=b.replace(new RegExp("\\b"+m.join("\\b|\\b")+"\\b","gi"),""):n[g]?n[g]=n[g].concat(m):n[g]=m))}}catch(B){d={error:B}}finally{try{k&&!k.done&&(h=t.return)&&h.call(t)}finally{if(d)throw d.error;}}}return{textAfterValidation:b,violationMap:n}},aa=function(a){if(/[^0-9\-\s]+/.test(a))return!1;var b=0,f=!1;a=a.replace(/\D/g,"");if(""===a)return!1;for(var d=a.length-1;0<=d;d--){var h=a.charAt(d);h=parseInt(h,10);f&&(h*=2,9<h&&(h-=9));b+=h;f=!f}return 0===b%10},C;(function(a){a.Rating="Rating";
a.Text="Text"})(C||(C={}));var ca=function(){var a=e["default"].cardRoot.getElementsByClassName("shoppingCxFeedbackRootWidget")[0];a&&z().getRatingFeedbackHtml().then(function(b){b&&b.outerHTML&&(a.innerHTML=b.outerHTML,ba())}).catch(function(b){r["default"].log("Experiencing some issues to load heimdall feedback widget rating view, trace: "+b,"ERROR")})},da=function(a){return"string"!==typeof a?(q.count("shoppingcxWidgetEmptyAsin",1),null):10<a.length||!Z.test(a)?(q.count("shoppingcxWidgetInvalidAsin",
1),null):a},ba=function(){var a=e["default"].cardRoot.getElementsByClassName("_shopping-cx-feedback-widget_style_shopping-cx-feedback-widget__3OJWU")[0],b=e["default"].cardRoot.getElementsByClassName("widgetContentContainer")[0],f=e["default"].cardRoot.getElementsByClassName("_shopping-cx-feedback-widget_style_feedback-radio-heading__3pMbk")[0],d=e["default"].cardRoot.getElementsByClassName("feedbackRadioButton"),h=e["default"].cardRoot.getElementsByClassName("_shopping-cx-feedback-widget_style_feedback-submit-button__1SErF")[0].getElementsByTagName("input")[0],
n=h.closest(".a-button");a&&q.count("shoppingcxWidgetGlanceView",1);var g=e["default"].cardRoot.getElementsByClassName("shoppingCxFeedbackRootWidget")[0],A=da(g.dataset.asin);for(g=0;g<d.length;g++){var t=d[g].getElementsByTagName("input")[0];t&&t.addEventListener("change",function(){h.disabled=!1;n.classList.remove("a-button-disabled")})}h.addEventListener("click",function(){h.disabled=!0;n.classList.add("a-button-disabled");for(var k=0;k<d.length;k++){var m=d[k].getElementsByTagName("input")[0];
m&&(m.disabled=!0)}q.count("ratingFeedbackSubmitted",1);k=e["default"].cardRoot.querySelector('input[type="radio"]:checked');var B=Number(k.value);ea(B,f.textContent,A);z().getTextFeedbackHtml().then(function(v){b&&(b.innerHTML=v.outerHTML);v=e["default"].cardRoot.getElementsByClassName("_shopping-cx-feedback-widget_style_feedback-submit-button__1SErF")[0];var p=e["default"].cardRoot.getElementsByTagName("textarea")[0],K=e["default"].cardRoot.getElementsByClassName("_shopping-cx-feedback-widget_style_text-feedback-alert-info__iTrz-")[0];
setTimeout(function(){p.focus()},0);if(v&&p){var w=!1;v.addEventListener("click",function(){q.count("textFeedbackSubmitted",1);w&&(D(!1),w=!1);var l=p.value,y=f.textContent,u=e["default"].cardRoot.getElementsByClassName("mkpID")[0];u=X[{ATVPDKIKX0DER:c.NA,A2EUQ1WTGCTBG2:c.NA,A1AM78C64UM0Y8:c.NA,A39IBJ37TRP1C6:c.FE,AD2EMQ3L3PG8S:c.FE,A1VC38T7YXB528:c.FE,A19VAU5U5O7RUS:c.FE,A1F83G8C2ARO7P:c.EU,A1PA6795UKMFR9:c.EU,A13V1IB3VIYZZH:c.EU,APJ6JRA9NG5V4:c.EU,A1RKKUPIHCS9HS:c.EU,ARBP9OOSHTCHU:c.EU,A21TJRUUN4KGV:c.EU,
A1805IZSGTT6HS:c.EU,A2VIGQ35RCS4UG:c.EU,A17E79C6D8DWNP:c.EU,A33AVAJ2PDY3EV:c.EU,A1C3SOZRARQ6R3:c.EU,A2NODRKZP88ZB9:c.EU}[u.value]];l={textAfterValidation:l,violationMap:{}};l=H(Y,l,!0);l=H(W,l,!1);u&&(l=H(u,l,!1));u=l.violationMap;if(0<Object.keys(u).length)r["default"].log("Feedback validation: "+Object.keys(u).toString(),"WARN"),L(!1),q.count("textFeedbackFailedValidation",1);else{l=l.textAfterValidation;y={feedbackType:C.Text,feedbackContentIntValue:B,feedbackContentString:encodeURIComponent(l),
feedbackQuestion:encodeURIComponent(y),feedbackAsin:A};M(y);if(y=e["default"].cardRoot.getElementsByClassName("_shopping-cx-feedback-widget_style_feedback-submit-button__1SErF")[0])y.getElementsByTagName("input")[0].disabled=!0;N()}});p.addEventListener("input",function(){K&&"none"===K.style.display&&L(!0);p.value&&0<p.value.length&&!w&&(D(!0),w=!0);p.value&&0<p.value.length||!w||(D(!1),w=!1)})}}).catch(function(v){r["default"].log("Experiencing some issues redricting to text feedback page, trace: "+
v,"ERROR");N()})});if(g=e["default"].cardRoot.getElementsByClassName("_shopping-cx-feedback-widget_style_close__2J0I_")[0])g.addEventListener("click",function(){O(a)}),g.addEventListener("keydown",function(k){"Enter"===k.key&&O(a)})},O=function(a){q.count("shoppingcxWidgetDismissed",1);D(!1);a&&(z().postWidgetDismissed().then(function(b){b.succeed||r["default"].log("Experiencing some service side issues when calling submitFeedback api with dismiss action: "+b.message,"ERROR")}).catch(function(b){r["default"].log("Experiencing some client side issues when calling submitFeedback api with dismiss action, trace: "+
b,"ERROR")}),E(a))},ea=function(a,b,f){a={feedbackType:C.Rating,feedbackContentIntValue:a,feedbackQuestion:encodeURIComponent(b),feedbackAsin:f};M(a)},M=function(a){z().postFeedbackData(a).then(function(b){b.succeed||r["default"].log("Experiencing some service side issues when calling submitFeedback api: "+b.message,"ERROR")}).catch(function(b){r["default"].log("Experiencing some client side issues when calling submitFeedback api, trace: "+b,"ERROR")})},E=function(a){a.style.display="none"},L=function(a){var b=
e["default"].cardRoot.getElementsByClassName("_shopping-cx-feedback-widget_style_text-feedback-alert-info__iTrz-")[0],f=e["default"].cardRoot.getElementsByClassName("_shopping-cx-feedback-widget_style_text-feedback-alert-error__1Y0pJ")[0],d=a?b:f;a=a?f:b;d&&a&&"none"!==a.style.display&&(E(a),d.style.display="inline-block")},D=function(a){var b,f;(null===(f=null===(b=null===G["default"]||void 0===G["default"]?void 0:G["default"].cardRoot)||void 0===b?void 0:b.ownerDocument)||void 0===f?void 0:f.defaultView).onbeforeunload=
a?function(d){d.preventDefault();d.returnValue=""}:null},N=function(){var a=e["default"].cardRoot.getElementsByClassName("widgetContentContainer")[0],b=e["default"].cardRoot.getElementsByClassName("_shopping-cx-feedback-widget_style_thank-you-view-placeholder__2G21U")[0],f=e["default"].cardRoot.getElementsByClassName("_shopping-cx-feedback-widget_style_shopping-cx-feedback-widget__3OJWU")[0],d=e["default"].cardRoot.getElementsByClassName("_shopping-cx-feedback-widget_style_close__2J0I_")[0];a&&b&&
(a.innerHTML=b.innerHTML);d&&E(d);setTimeout(function(){f&&E(f)},3E3)};I._operationNames=["getRatingFeedbackHtml","getTextFeedbackHtml","postFeedbackData","postWidgetDismissed"];I.card=function(){return F.__awaiter(void 0,void 0,void 0,function(){return F.__generator(this,function(a){U["default"].pageReady.then(ca);return[2]})})}});
