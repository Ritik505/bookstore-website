'use strict';mix_d("MorpheusPopularityRankSidesheetCards__morpheus-popularity-rank-sidesheet-card:morpheus-popularity-rank-sidesheet-card__Xov2o8KB","exports tslib @c/browser-operations @c/logger @c/scoped-dom @p/monarch-sidesheet @c/metrics @c/dom @c/remote-operations @p/A".split(" "),function(M,l,C,ra,sa,ta,ua,N,va,wa){function E(a){return a&&"object"===typeof a&&"default"in a?a:{"default":a}}var xa=E(C),ea=E(ra),p=E(sa),K=E(ta);C=E(va);var O=E(wa),t=function(a,b){void 0===b&&(b=1);ua.count(a,b)},
ya=function(a){return l.__awaiter(void 0,void 0,void 0,function(){var b,d;return l.__generator(this,function(c){a.classList.contains("morpheusAodEntryLink")&&!a.classList.contains("morpheusAodDeclarativeAction")&&(K["default"].closeSidesheet(a.id),b=null===(d=a.parentElement)||void 0===d?void 0:d.getElementsByClassName("morpheusAodDeclarativeAction")[0])&&(b.click(),t("morpheusAODClicked"));return[2]})})},F;(function(a){a.editionClickHandler="editionClickHandler";a.aodLinkClickHandler="aodLinkClickHandler";
a.sortingOptionTagHandler="sortingOptionTagHandler";a.formatFilterClickHandler="formatFilterClickHandler";a.formatFilterPaginationClickHandler="formatFilterPaginationClickHandler"})(F||(F={}));var w=function(a){P(a)&&a.classList.add("aok-hidden")},x=function(a){a&&!P(a)&&a.classList.remove("aok-hidden")},P=function(a){return a&&!a.classList.contains("aok-hidden")},H=function(a){try{var b=a.split("products/")[1].split("/");var d=null===b||void 0===b?void 0:b[0]}catch(f){throw Error("Failed to extract ASIN from URI "+
a);}var c=new URLSearchParams(a.split("?")[1]);a=c.get("pageSize");b=c.get("pageNumber");var e=c.get("selectedFormats");c=c.get("sortBy");return{asin:d,pageSize:null!==a?Number(a):void 0,pageNumber:null!==b?Number(b):void 0,selectedFormats:null!==e?JSON.parse(decodeURIComponent(e)):void 0,sortBy:null!==c?c:void 0}},h;(function(a){a.MORPHEUS_HEADER="#morpheus-header";a.FORMAT_FILTER_GROUP="#format-filters";a.EDITIONS_LIST_CONTAINER="#morpheus-asin-list";a.EDITIONS_LIST="#editions-list";a.ROW_LINK_MESSAGE=
"#row-link-message";a.PAGINATION_CONTAINER="#editions-pagination-container";a.LANGUAGES_DROPDOWN="#morpheus-language-relation-dropdown-format-filters";a.LANGUAGES_DROPDOWN_BUTTON="#morpheus-language-relation-dropdown";a.SEE_MORE_LINK="#pagination-see-more-link";a.NEXT_URL="#pagination-next-url";a.PAGINATION_SPINNER="#morpheus-pagination-spinner";a.RESULTS_ROW="#number-of-results-row";a.ALL_FORMAT="#all-format";a.ERROR_VIEW="#morpheus-sidesheet-error-view";a.ERROR_VIEW_CLONE="#morpheus-sidesheet-error-view-clone";
a.FILTER_BUTTONS_CONTAINER="#filter-buttons-container";a.FORMAT_FILTERS_ID_SUFFIX="filter";a.SCROLL_LEFT_BUTTON="#scroll-left-button";a.SCROLL_RIGHT_BUTTON="#scroll-right-button";a.ORIGINAL_FORMATS_LIST="#original-formats-list";a.FORMATS_AND_LANGUAGES_CONTAINER="#languages-filters-header-container";a.SELECTED_SORTING_OPTION="#selected-sorting-option";a.SHOULD_RELOAD_INGRESS="#should-reload-for-ingress";a.SORTING_DROPDOWN_NAME="sortingDropdown"})(h||(h={}));var y;(function(a){a.ALL="ALL";a.FORMAT_REFERENCE_DATA_PARAM=
"data-format-reference";a.DATA_PARAM="data-param";a.VALUE_PARAM="value";a.SELECTED_DATA_PARAM="data-a-selected";a.DIRECTION_DATA_PARAM="data-direction"})(y||(y={}));var B=function(a){return a.querySelector(h.PAGINATION_CONTAINER)},Q=function(a){var b;return null===(b=B(a))||void 0===b?void 0:b.querySelector(h.NEXT_URL)},fa=function(a){a=a.querySelector(h.FORMAT_FILTER_GROUP);a=Array.from(a.childNodes).filter(function(b){return"true"===b.getAttribute(y.SELECTED_DATA_PARAM)}).map(function(b){return b.id.replace("-"+
h.FORMAT_FILTERS_ID_SUFFIX,"")});0===a.length&&a.push(y.ALL);return a},za=function(a){var b;return null!==(b=a.querySelector(h.ORIGINAL_FORMATS_LIST).getAttribute(y.DATA_PARAM))&&void 0!==b?b:""},R=function(a,b){a&&(b=b.cloneNode(!0),b.id=h.ERROR_VIEW_CLONE.replace("#",""),a.appendChild(b),x(b))},ha=function(a){var b=a?a:p["default"].cardRoot,d=b.querySelector(h.FORMAT_FILTER_GROUP);1<(null===d||void 0===d?void 0:d.children.length)&&Array.from(d.childNodes).filter(function(c){return"true"===c.getAttribute(y.SELECTED_DATA_PARAM)}).reverse().forEach(function(c){d.removeChild(c);
d.prepend(c)});null===d||void 0===d?void 0:d.childNodes.forEach(function(c){c.addEventListener("click",function(e){var f=b.querySelector(h.FORMAT_FILTER_GROUP);e=e.currentTarget;if(f&&f.childNodes&&e){var k=e.nextElementSibling,m=e.previousElementSibling;k?k.focus():m&&m.focus();f.removeChild(e);"true"!==e.getAttribute(y.SELECTED_DATA_PARAM)?f.prepend(e):Aa(b,e,f)}});c.addEventListener("focus",function(e){e=e.target;var f,k=null===(f=e.closest(h.FILTER_BUTTONS_CONTAINER))||void 0===f?void 0:f.parentElement;
k&&e&&(f=e.getBoundingClientRect(),k=k.getBoundingClientRect(),(f.left<k.left||f.right>k.right)&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:f.left<k.left?"start":"end"}))})})},Aa=function(a,b,d){if(a=za(a)){var c=JSON.parse(a);a=c.indexOf(b.id);var e=0;d.childNodes.forEach(function(f){"true"===f.getAttribute(y.SELECTED_DATA_PARAM)&&(e++,c.splice(c.indexOf(f.id),1))});a>=d.children.length?d.appendChild(b):d.insertBefore(b,d.children[c.indexOf(b.id)+e])}},u;(function(a){a.INGRESS_LINK_CLICK=
"Morpheus.Desktop.IngressLinkClick";a.LANGUAGE_RELATION_CLICK="Morpheus.Desktop.LanguageRelationClick";a.FORMAT_FILTER_CLICK="Morpheus.Desktop.FormatFilterClick";a.FORMAT_FILTER_PAGINATION_TRIGGERED="Morpheus.Desktop.FormatFilterPaginationTriggered";a.SORTING_PILL_CLICK="Morpheus.Desktop.SortingPillClick";a.LANGUAGE_RELATION_OPTION_CLICK="Morpheus.Desktop.LanguageRelationOptionClick";a.LANGUAGE_INGRESS_LINK_CLICK="Morpheus.Desktop.LanguageIngressLinkClick";a.INGRESS_LINK_CLICK_ERROR="Morpheus.Desktop.IngressLinkClick.Error";
a.LANGUAGE_RELATION_CLICK_ERROR="Morpheus.Desktop.LanguageRelationClick.Error";a.FORMAT_FILTER_CLICK_ERROR="Morpheus.Desktop.FormatFilterClick.Error";a.FORMAT_FILTER_PAGINATION_TRIGGERED_ERROR="Morpheus.Desktop.FormatFilterPaginationTriggered.Error";a.SORTING_PILL_CLICK_ERROR="Morpheus.Desktop.SortingPillClick.Error"})(u||(u={}));var S=function(a){var b;a=a.getBoundingClientRect();var d=(null===(b=p["default"].cardRoot.querySelector(h.FILTER_BUTTONS_CONTAINER))||void 0===b?void 0:b.parentElement).getBoundingClientRect();
return{isVisible:a.left>=d.left&&a.right<=d.right,isLeftHidden:a.left<d.left,isRightHidden:a.right>d.right}},ia=function(a){var b,d=a.target;if((a=p["default"].cardRoot.querySelector(h.FORMAT_FILTER_GROUP).children)&&d&&(d=null!==(b=d.getAttribute(y.DIRECTION_DATA_PARAM))&&void 0!==b?b:"")){if("right"===d)for(b=0;b<a.length;b++){var c=a[b],e=S(c);if(e.isRightHidden){var f=c;break}}else for(b=a.length-1;0<=b;b--)if(c=a[b],e=S(c),e.isLeftHidden){f=c;break}f&&f.scrollIntoView({behavior:"smooth",block:"nearest",
inline:"right"===d?"start":"end"})}},ja=function(){var a=p["default"].cardRoot.querySelector(h.SCROLL_LEFT_BUTTON),b=p["default"].cardRoot.querySelector(h.SCROLL_RIGHT_BUTTON),d=p["default"].cardRoot.querySelector(h.FORMAT_FILTER_GROUP);d&&(d.addEventListener("focusin",D),d.childNodes.forEach(function(c){c.addEventListener("mouseover",D)}));a&&b&&(a.addEventListener("click",function(c){ia(c);D()}),a.addEventListener("mouseover",function(){D()}),b.addEventListener("mouseover",function(){D()}),b.addEventListener("click",
function(c){ia(c);D()}),D())},D=function(){var a,b=p["default"].cardRoot.querySelector(h.SCROLL_LEFT_BUTTON),d=p["default"].cardRoot.querySelector(h.SCROLL_RIGHT_BUTTON),c=null===(a=p["default"].cardRoot.querySelector(h.FORMAT_FILTER_GROUP))||void 0===a?void 0:a.children;if(c&&b&&d){var e=!1;a=!1;for(var f=0;f<c.length;f++){var k=S(c[f]);k.isLeftHidden&&(e=!0);k.isRightHidden&&(a=!0)}c=b.querySelector("input");e?(b.classList.remove("a-button-disabled"),c.disabled=!1):(b.classList.add("a-button-disabled"),
b.classList.remove("a-button-focus"),c.disabled=!0);b=d.querySelector("input");a?(d.classList.remove("a-button-disabled"),b.disabled=!1):(d.classList.add("a-button-disabled"),d.classList.remove("a-button-focus"),b.disabled=!0,b.focus())}},v;(function(a){a.CLOSE="morpheus-sidesheet-close";a.ROOT="morpheusRoot";a.SIDESHEET="morpheus-sidesheet";a.SIDESHEET_BODY="morpheus-sidesheet-main-body";a.SIDESHEET_SPINNER="morpheus-sidesheet-spinner";a.SIDESHEET_ERROR_VIEW="morpheus-sidesheet-error-view";a.SIDESHEET_ERROR_VIEW_CLONED=
"morpheus-sidesheet-error-view-cloned";a.SIDESHEET_BACKGROUND="morpheus-darkened-background";a.SIDESHEET_CONTENT="morpheus-sidesheet-content-container"})(v||(v={}));var L=function(){var a=p["default"].cardRoot.querySelector("#"+v.SIDESHEET_SPINNER);T();x(a);return a},ka=function(a,b,d,c,e){var f=c.querySelector(h.EDITIONS_LIST_CONTAINER),k=c.querySelector(h.FORMATS_AND_LANGUAGES_CONTAINER);c=c.querySelector(h.RESULTS_ROW);a.innerHTML=f.innerHTML;b.innerHTML=k.innerHTML;d.innerHTML=c.innerHTML;ja();
ha();f=B(e);e=Q(e);f&&e&&U().observe(N.unscope(f));I();x(a);x(d);x(b)},V=function(a){var b=p["default"].cardRoot.querySelector("#"+v.SIDESHEET_SPINNER),d=p["default"].cardRoot.querySelector("#"+v.SIDESHEET_ERROR_VIEW);w(b);a?(b=d.cloneNode(!0),b.id=v.SIDESHEET_ERROR_VIEW_CLONED,a.appendChild(b),x(b)):x(d)},T=function(){var a=p["default"].cardRoot.querySelector("#"+v.SIDESHEET_ERROR_VIEW);P(a)&&w(a);(a=p["default"].cardRoot.querySelector("#"+v.SIDESHEET_ERROR_VIEW_CLONED))&&a.remove()},I=function(){var a=
p["default"].cardRoot.querySelector("#"+v.SIDESHEET_SPINNER);w(a);T()},Ba=function(a,b){void 0===b&&(b=u.INGRESS_LINK_CLICK_ERROR);V(a);t(b)},G,W,Ca=C["default"].setup(),la=function(a){return l.__awaiter(void 0,void 0,void 0,function(){var b,d,c,e,f,k,m,q,n,r;return l.__generator(this,function(g){switch(g.label){case 0:b=null===(r=Q(a))||void 0===r?void 0:r.value;if(!b)return[3,4];t(""+u.FORMAT_FILTER_PAGINATION_TRIGGERED);var z;d=null===(z=B(a))||void 0===z?void 0:z.querySelector(h.SEE_MORE_LINK);
var A;c=null===(A=B(a))||void 0===A?void 0:A.querySelector(h.PAGINATION_SPINNER);e=B(a);f=a.querySelector(h.EDITIONS_LIST);w(d);x(c);g.label=1;case 1:return g.trys.push([1,3,,4]),T(),k=H(b),k.isLanguageRelationDropdownSelected=G,[4,Ca.getPageHTML(l.__assign({},k))];case 2:m=g.sent();q=m.querySelector(h.EDITIONS_LIST);n=B(m);if(!q)return x(e),V(),t(u.FORMAT_FILTER_PAGINATION_TRIGGERED_ERROR+".NoEditionsList"),[2];f.insertAdjacentHTML("beforeend",q.innerHTML);e.innerHTML=null===n||void 0===n?void 0:
n.innerHTML;w(c);x(d);return[3,4];case 3:return g.sent(),w(c),V(f),x(d),t(""+u.FORMAT_FILTER_PAGINATION_TRIGGERED_ERROR),[3,4];case 4:return[2]}})})},U=function(){var a=p["default"].cardRoot.querySelector("#"+v.SIDESHEET),b=0,d=new IntersectionObserver(function(c){var e=l.__read;a:{var f=b,k=d,m;try{for(var q=l.__values(c),n=q.next();!n.done;n=q.next())if(n.value.isIntersecting&&(la(a),f++,2<=f)){k.disconnect();var r=[f,k];break a}}catch(z){var g={error:z}}finally{try{n&&!n.done&&(m=q.return)&&m.call(q)}finally{if(g)throw g.error;
}}r=[f,k]}c=e.call(l,r,2);e=c[1];b=c[0];d=e},{threshold:0});return d},Da=C["default"].setup(),Ea=function(a,b){return l.__awaiter(void 0,void 0,void 0,function(){var d,c,e,f,k,m,q,n,r;return l.__generator(this,function(g){switch(g.label){case 0:d=b.value,c=a.querySelector(h.EDITIONS_LIST_CONTAINER),e=a.querySelector(h.FORMATS_AND_LANGUAGES_CONTAINER),f=a.querySelector(h.RESULTS_ROW),k=a.querySelector(h.ERROR_VIEW),w(c),w(e),w(f),L(),g.label=1;case 1:return g.trys.push([1,3,,4]),t(""+u.LANGUAGE_RELATION_CLICK),
G=W||!1,m=H(d),m.selectedFormats=[y.ALL],m.isLanguageRelationDropdownSelected=G,[4,Da.getPageHTML(l.__assign({},m))];case 2:return q=g.sent(),ka(c,e,f,q,a),n=a.querySelector(h.LANGUAGES_DROPDOWN_BUTTON),n.focus(),[3,4];case 3:throw r=g.sent(),t(""+u.LANGUAGE_RELATION_CLICK_ERROR),x(e),R(e.parentElement,k),I(),r;case 4:return[2]}})})},Fa=C["default"].setup(),Ga=function(a,b){return l.__awaiter(void 0,void 0,void 0,function(){var d,c,e,f,k,m,q,n,r;return l.__generator(this,function(g){switch(g.label){case 0:t(u.SORTING_PILL_CLICK),
d=b.value,c=a.querySelector(h.EDITIONS_LIST_CONTAINER),e=a.querySelector(h.FORMATS_AND_LANGUAGES_CONTAINER),f=a.querySelector(h.RESULTS_ROW),k=a.querySelector(h.ERROR_VIEW),w(c),w(e),w(f),L(),g.label=1;case 1:return g.trys.push([1,3,,4]),G=W||!1,m=H(d),m.sortBy&&t(u.SORTING_PILL_CLICK+"."+m.sortBy),m.selectedFormats=fa(a),m.isLanguageRelationDropdownSelected=G,[4,Fa.getPageHTML(l.__assign({},m))];case 2:return q=g.sent(),ka(c,e,f,q,a),n=a.querySelector('select[name="'+h.SORTING_DROPDOWN_NAME+'"]'),
n.focus(),[3,4];case 3:throw r=g.sent(),x(e),R(e.parentElement,k),I(),t(""+u.SORTING_PILL_CLICK_ERROR),r;case 4:return[2]}})})},Ha=C["default"].setup(),Ia=function(){return l.__awaiter(void 0,void 0,void 0,function(){var a,b,d,c,e,f,k,m,q;return l.__generator(this,function(n){switch(n.label){case 0:t(u.INGRESS_LINK_CLICK);a=p["default"].cardRoot;b=a.getElementsByClassName("_bW9yc_sidesheet_18DM8")[0];d=p["default"].cardRoot.getElementsByClassName("_bW9yc_sidesheet-main-body_qw6om")[0];c=a.getElementsByClassName("landingAsinValue")[0];
e=!!a.querySelector(h.SHOULD_RELOAD_INGRESS);if(!b||!c||!c.value)return ea["default"].log("Not able to open see all formats sidesheet, missing necessary component.","FATAL"),[2];K["default"].show();if(e)return[2];f=L();n.label=1;case 1:return n.trys.push([1,3,,4]),[4,Ha.getPageHTML({asin:c.value})];case 2:return k=n.sent(),w(f),d.innerHTML=k.outerHTML,ja(),ha(),m=B(a),q=Q(a),m&&q&&U().observe(N.unscope(m)),O["default"].on("a:dropdown:selected:sortingDropdown",function(r){return l.__awaiter(void 0,
void 0,void 0,function(){return l.__generator(this,function(g){switch(g.label){case 0:return[4,Ga(a,r)];case 1:return g.sent(),[2]}})})}),O["default"].on("a:dropdown:selected:languageRelationDropdown",function(r){return l.__awaiter(void 0,void 0,void 0,function(){var g,z;return l.__generator(this,function(A){switch(A.label){case 0:return g=null!==(z=r.nativeItemNode.dataset.languagevalue)&&void 0!==z?z:"",t(u.LANGUAGE_RELATION_OPTION_CLICK+"."+g),[4,Ea(a,r)];case 1:return A.sent(),[2]}})})}),[3,4];
case 3:return n.sent(),Ba(d),[3,4];case 4:return[2]}})})},Ja=C["default"].setup(),Ka=function(a){return l.__awaiter(void 0,void 0,void 0,function(){var b,d,c,e,f,k,m,q,n,r,g,z,A,ma,na,oa,X;return l.__generator(this,function(J){switch(J.label){case 0:t(u.FORMAT_FILTER_CLICK);b=fa(a);t(u.FORMAT_FILTER_CLICK+".selectedFormats",b.length);var pa=b[0],Y,Z,aa,ba;d=pa===y.ALL?null!==(Z=null===(Y=a.querySelector(h.ALL_FORMAT))||void 0===Y?void 0:Y.getAttribute(y.FORMAT_REFERENCE_DATA_PARAM))&&void 0!==Z?Z:
"":null!==(ba=null===(aa=a.querySelector("#"+pa+"-"+h.FORMAT_FILTERS_ID_SUFFIX))||void 0===aa?void 0:aa.getAttribute(y.FORMAT_REFERENCE_DATA_PARAM))&&void 0!==ba?ba:"";c=H(d);e=a.querySelector(h.EDITIONS_LIST_CONTAINER);f=a.querySelector(h.ERROR_VIEW);k=a.querySelector(h.RESULTS_ROW);w(e);w(k);L();J.label=1;case 1:J.trys.push([1,3,,4]);(m=a.querySelector(h.ERROR_VIEW_CLONE))&&!m.classList.contains("aok-hidden")&&m.remove();c.selectedFormats=b;c.isLanguageRelationDropdownSelected=G;var ca;if(q=null===
(ca=a.querySelector('select[name="'+h.SORTING_DROPDOWN_NAME+'"]'))||void 0===ca?void 0:ca.querySelector("option[selected]"))n=null!==(X=q.getAttribute(y.VALUE_PARAM))&&void 0!==X?X:"",0!==n.length&&(r=H(n),c.sortBy=r.sortBy);return[4,Ja.getPageHTML(l.__assign({},c))];case 2:return g=J.sent(),z=g.querySelector(h.EDITIONS_LIST_CONTAINER),e.innerHTML=z.innerHTML,A=B(e),ma=g.querySelector(h.RESULTS_ROW),k.innerHTML=ma.innerHTML,A&&U().observe(N.unscope(A)),I(),x(k),x(e),[3,4];case 3:throw na=J.sent(),
I(),oa=a.querySelector(h.MORPHEUS_HEADER),R(oa,f),t(u.FORMAT_FILTER_CLICK_ERROR),na;case 4:return[2]}})})},da=!1,qa=function(a,b,d){return l.__awaiter(void 0,void 0,void 0,function(){return l.__generator(this,function(c){switch(c.label){case 0:if(b)return[3,2];d&&t(u.LANGUAGE_INGRESS_LINK_CLICK);da=!0;return[4,Ia()];case 1:c.sent(),da=!1,c.label=2;case 2:return[2]}})})};M._operationNames=["getPageHTML"];M.callIngressLinkClickHandler=qa;M.card=function(){return l.__awaiter(void 0,void 0,void 0,function(){var a,
b,d,c,e,f,k,m,q,n;return l.__generator(this,function(r){a=p["default"].cardRoot.querySelector("#"+v.ROOT);if(!a)return[2];b=p["default"].cardRoot.querySelector("#"+v.SIDESHEET);d=p["default"].cardRoot.querySelector("#"+v.SIDESHEET_BODY);c=p["default"].cardRoot.querySelector("#"+v.SIDESHEET_BACKGROUND);e=p["default"].cardRoot.querySelector("#"+v.SIDESHEET_SPINNER);f=p["default"].cardRoot.querySelector("#"+v.CLOSE);k=[b,d,c,e,f];if(k.every(function(g){return g})&&k.map(function(g){return g.id}).every(function(g){return g}))K["default"].initialize.apply(K["default"],
l.__spread(k.map(function(g){return g.id}))),f.tabIndex=0;else return ea["default"].log("Not able to initialize see all formats sidesheet, missing necessary component or component id.","FATAL"),[2];m=p["default"].cardRoot.getElementsByClassName("shouldShowLanguageRelation")[0];W=q="true"===m.value;n=xa["default"].setup().define;n(F.formatFilterPaginationClickHandler,"click",function(){return l.__awaiter(void 0,void 0,void 0,function(){return l.__generator(this,function(g){switch(g.label){case 0:return[4,
la(b)];case 1:return g.sent(),[2]}})})});n(F.editionClickHandler,"click",function(){t("morpheusEditionItemClicked")});n(F.aodLinkClickHandler,"click",function(g){ya(g.target)});O["default"].on("akira:morpheusIngress:clicked",function(){return l.__awaiter(void 0,void 0,void 0,function(){return l.__generator(this,function(g){switch(g.label){case 0:return[4,qa(b,da,q)];case 1:return g.sent(),[2]}})})});n(F.formatFilterClickHandler,"click",function(){return l.__awaiter(void 0,void 0,void 0,function(){return l.__generator(this,
function(g){switch(g.label){case 0:return[4,Ka(b)];case 1:return g.sent(),[2]}})})});return[2]})})}});
